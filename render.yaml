services:
  - type: web
    name: possue2-backend
    runtime: node
    buildCommand: npm install && npm run build
    startCommand: npm run start
    # CRITICAL: Database preservation settings
    # These settings ensure existing user data is NEVER overwritten
    preDeployCommand: |
      echo "ðŸš¨ CRITICAL: Starting deployment with user data protection"
      echo "Database preservation mode: ENABLED"
      echo "Existing DATABASE_URL will be preserved"
      echo "User data protection: ACTIVE"
    envVars:
      - key: NODE_VERSION
        value: 20.0.0
      - key: NODE_ENV
        value: production
      - key: STRAPI_DISABLE_UPDATE_NOTIFICATION
        value: true
      # CRITICAL: DATABASE_URL must be set manually in Render dashboard
      # NEVER change this without explicit backup verification
      # Existing database contains live user data - HANDLE WITH EXTREME CARE
      
      # Email verification environment variables
      - key: CLIENT_URL
        value: https://possue.com
      - key: SENDGRID_FROM_NAME
        value: Possue Team
      - key: CONFIRMATION_TOKEN_EXPIRY_HOURS
        value: 24
      
      # Security keys (regenerated only on first deploy)
      - key: APP_KEYS
        generateValue: true
      - key: API_TOKEN_SALT
        generateValue: true
      - key: ADMIN_JWT_SECRET
        generateValue: true
      - key: TRANSFER_TOKEN_SALT
        generateValue: true
      - key: JWT_SECRET
        generateValue: true

# CRITICAL DATABASE PROTECTION NOTICE:
# ====================================
# 
# 1. DATABASE_URL must be set manually in Render dashboard
# 2. NEVER modify DATABASE_URL without confirmed backup
# 3. Existing database contains live user data
# 4. Schema changes require migration scripts
# 5. Always run pre-deployment backup script first
#
# Emergency contacts and procedures documented in:
# - DEPLOYMENT-CHECKLIST.md
# - EMERGENCY-ROLLBACK-PROCEDURES.md